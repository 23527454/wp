<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.modules.mj.dao.AuthorizationDao">
	
	<!-- 查询数据
	<select id="findList" resultType="Authorization">
		SELECT ${sqlMap.column.toSql()}
		FROM ${sqlMap.table.toSql()}
		<where>
			${sqlMap.where.toSql()}
		</where>
		ORDER BY ${sqlMap.order.toSql()}
	</select> -->

	<select id="get" resultType="Authorization">
		SELECT *
		FROM mj_authorization
		WHERE id = #{id} and del_flag = '0'
	</select>

	<update id="delete">
		DELETE FROM mj_authorization WHERE id = #{id}
	</update>

	<select id="getCountBySId" resultType="Integer">
		select count(1) from mj_authorization WHERE staff_id = #{staffId} AND access_para_info_id=#{accessParaInfoId}
	</select>

	<select id="findList" resultType="Authorization">
		SELECT *
		FROM mj_authorization
		<where>
			del_flag = '0'
			<if test="accessParaInfoId != null and accessParaInfoId != ''">
				AND access_para_info_id = #{accessParaInfoId}
			</if>
			<if test="staffName!=null and staffName != ''">
				AND staff_id in (
					select id
					from guard_staff
					where name like CONCAT('%', #{staffName}, '%')
				)
			</if>
			<if test="workNum!=null and workNum != ''">
				AND work_num = #{workNum}
			</if>
		</where>
		<choose>
			<otherwise>
				ORDER BY create_date
			</otherwise>
		</choose>
	</select>

	<update id="update">
		UPDATE mj_authorization SET
		staff_id=#{staff.id},
		access_para_info_id=#{accessParaInfoId},
		timezone_info_num=#{timezoneInfoNum},
		staff_group=#{staffGroup},
		check_pom=#{checkPom},
		work_day_num=#{workDayNum},
		remarks=#{remarks}
		WHERE id=#{id}
	</update>

	<insert id="insert" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO mj_authorization
		VALUES (DEFAULT ,
		#{staff.id},
		#{accessParaInfoId},
		#{timezoneInfoNum},
		#{staffGroup},
		#{checkPom},
		#{workDayNum},
		#{createBy.id},
		#{createDate},
		#{updateBy.id},
		#{updateDate},
		#{remarks},
		DEFAULT)
	</insert>

	<delete id="deleteById">
		delete from mj_authorization where id=#{id}
	</delete>

	<delete id="deleteByAId">
		delete from mj_authorization where access_para_info_id=#{id}
	</delete>

</mapper>